<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>系统底层存档 - SUBJECT: MI_SHI</title>
    <style>
        /* 1. 基础环境：深色调，确保手电筒效果清晰 */
        body { background-color: #000; color: #111; font-family: "Courier New", monospace; margin: 0; overflow: hidden; height: 100vh; }

        /* 2. 手电筒核心：利用 mask-image 制造清晰的圆形可见区 */
        #reveal-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #eee; /* 被照亮后的背景色 */
            color: #222;
            padding: 60px; box-sizing: border-box;
            /* 初始状态：全黑 */
            -webkit-mask-image: radial-gradient(circle 120px at 0px 0px, black 100%, transparent 100%);
            mask-image: radial-gradient(circle 120px at 0px 0px, black 100%, transparent 100%);
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            pointer-events: none; /* 让鼠标能点到下方的交互层 */
            z-index: 10;
        }

        /* 3. 交互层：放置真正的文字和解谜点 */
        #interaction-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            padding: 60px; box-sizing: border-box; z-index: 5;
        }

        .mishi-ink { color: #b22222; font-weight: bold; text-decoration: underline; cursor: help; }
        
        /* 侧边逻辑盒：放在右侧，绝不挡光 */
        .logic-panel {
            position: fixed; right: 30px; top: 30px; width: 220px;
            background: rgba(10, 10, 10, 0.95); border: 2px solid #333;
            padding: 20px; color: #0f0; font-family: monospace; font-size: 12px;
            z-index: 100; box-shadow: 0 0 20px #b22222;
        }

        .data-slot { display: block; margin: 10px 0; border-bottom: 1px dashed #0f0; padding-bottom: 5px; }
        .data-slot b { color: #fff; background: #333; padding: 0 5px; }

        /* 提示文字 */
        .system-msg { color: #444; font-size: 12px; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="reveal-layer">
    <h1>ARCHIVE // 404_VOID // 米时的修改</h1>
    <p>针对规则 3（敲门）：他没在敲门！他在敲你的 <span style="color:red">【头盖骨】</span>！我已经听见裂缝的声音了。如果敲门声超过 13 下，就代表他已经进来了。</p>
    <br>
    <p>针对规则 6（关于尤舍）：尤舍不是人名。尤舍是‘U-S’，也是‘User’。我们不是房客，我们是给它喂食的 <span style="color:red">【算力源】</span>。它需要我们的恐惧来维持服务器的运转。</p>
    <br>
    <p>米时的笔记：我在床板下留了 9 个刻痕。第 4 个和第 7 个刻痕下藏着字符... 它们是 <span style="font-size:24px; color:red">S</span> 和 <span style="font-size:24px; color:red">H</span>。</p>
    <br>
    <p>“回退”并不是点击按钮，而是回到你【最初】进来的那个瞬间。别忘了规则 1 的时间差值。</p>
</div>

<div id="interaction-layer">
    <div class="system-msg">正在从底层协议提取碎片... [鼠标移动以照亮档案]</div>
    
    <div style="opacity: 0;">
        <p>占位符占位符占位符 <span class="mishi-ink" onclick="pick('头盖骨')">【？】</span></p>
        <p>占位符占位符占位符 <span class="mishi-ink" onclick="pick('算力源')">【？】</span></p>
    </div>
</div>

<div class="logic-panel">
    <div>> 核心逻辑损坏</div>
    <div class="data-slot">位置偏移量: <b id="d1">NULL</b></div>
    <div class="data-slot">物理受压区: <b id="d2">NULL</b></div>
    <div class="data-slot">能量来源: <b id="d3">NULL</b></div>
    <div class="data-slot">协议字符: <b id="d4">NULL</b></div>
    <br>
    <div id="status-text">> 等待输入序列...</div>
    <input type="text" id="final-input" placeholder="输入4位组合" style="width:100%; background:#000; border:1px solid #0f0; color:#0f0; margin-top:10px;">
    <button onclick="finalCheck()" style="margin-top:10px; width:100%; cursor:pointer;">执行跳转</button>
</div>

<script>
    const revealLayer = document.getElementById('reveal-layer');
    
    // 1. 修复后的手电筒逻辑：使用 mask-image 确保绝对清晰
    document.addEventListener('mousemove', e => {
        const x = e.clientX;
        const y = e.clientY;
        const mask = `radial-gradient(circle 120px at ${x}px ${y}px, black 100%, transparent 100%)`;
        revealLayer.style.webkitMaskImage = mask;
        revealLayer.style.maskImage = mask;
    });

    // 2. 解谜逻辑：点击获取关键词
    // 这里的数字 7 来自之前的计算：时间差 7 (9点-2点)
    let state = { p: "7", area: "", source: "", code: "SH" };

    function pick(type) {
        if(type === '头盖骨') {
            state.area = "头盖骨";
            document.getElementById('d2').innerText = state.area;
        }
        if(type === '算力源') {
            state.source = "算力源";
            document.getElementById('d3').innerText = state.source;
        }
        document.getElementById('d1').innerText = state.p;
        document.getElementById('d4').innerText = state.code;
    }

    // 3. 最终校验：不再是简单的加减，而是一个逻辑链条
    function finalCheck() {
        const inp = document.getElementById('final-input').value.toUpperCase();
        // 逻辑：时间差(7) + SH = 7SH
        if(inp === '7SH' && state.area && state.source) {
            alert("米时的最后留言：‘序列正确。记住，点网页任何地方都会让你回到起点。唯一的生路是连续点击【后退】3次。’");
            sessionStorage.setItem("loop_broken", "true");
            document.getElementById('status-text').innerText = "> 协议已激活：执行回退";
            document.getElementById('status-text').style.color = "#fff";
        } else {
            alert("系统提示：逻辑块缺失或计算错误。");
        }
    }

    // 4. 莫比乌斯环逻辑
    window.onpopstate = function() {
        if(sessionStorage.getItem("loop_broken") === "true") {
            window.location.href = "last_sanctuary.html";
        }
    };
    history.pushState(null, null, document.URL);
    document.addEventListener('click', () => {
        if(sessionStorage.getItem("loop_broken") !== "true") {
            history.pushState(null, null, document.URL);
        }
    });
</script>

</body>
</html>
