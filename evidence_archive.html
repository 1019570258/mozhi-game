<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>系统底层存档 - SUBJECT: MI_SHI</title>
    <style>
        :root { --cursor-x: 0px; --cursor-y: 0px; }
        body { background-color: #050505; color: #333; font-family: "Courier New", monospace; margin: 0; overflow: hidden; height: 100vh; }

        /* 尤舍的监控层：模糊、闪烁 */
        .system-data { 
            padding: 50px; line-height: 1.8; font-size: 14px; 
            filter: blur(4px); transition: filter 0.3s;
            user-select: none;
        }

        /* 米时的手电筒：跟随鼠标的视觉清晰区 */
        .flashlight {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            background: radial-gradient(circle 150px at var(--cursor-x) var(--y), transparent 10%, rgba(0,0,0,0.95) 100%);
            z-index: 10;
        }

        /* 疯狂的修改规则（放在清晰区才可见） */
        .mishi-ink { color: #b22222; font-weight: bold; }
        
        /* 交互解密区：不再挡住文字，放在底部侧边 */
        .side-console {
            position: fixed; right: 20px; bottom: 20px; width: 250px;
            background: rgba(20, 20, 20, 0.9); border: 1px solid #444;
            padding: 15px; color: #0f0; font-size: 12px; z-index: 20;
        }
        .slot { border-bottom: 1px solid #0f0; color: #fff; font-weight: bold; cursor: pointer; }
        
        .error-shake { animation: shake 0.2s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 100% { transform: translate(-1px, -1px); } }
    </style>
</head>
<body>

<div class="flashlight" id="flashlight"></div>

<div class="system-data" id="content">
    <p>LOG_REF: 404_VOID // 状态：已录入</p>
    <p>针对规则 3（敲门）：他没在敲门！他在敲你的<span class="mishi-ink">【头盖骨】</span>！我已经听见裂缝的声音了。如果敲门声超过 13 下，就代表他已经进来了。</p>
    <p>针对规则 6（关于尤舍）：尤舍不是人名。尤舍是‘U-S’，也是‘User’。我们不是房客，我们是给它喂食的<span class="mishi-ink">【算力源】</span>。它需要我们的恐惧来维持服务器的运转。</p>
    <br>
    <p>米时的涂鸦：我留下的 9 个刻痕里，第 4 个和第 7 个刻痕下藏着字符... 它们是 <span class="mishi-ink">S</span> 和 <span class="mishi-ink">H</span>。</p>
    <p>“回退”并不是点击按钮，而是回到你【最初】进来的那个瞬间。</p>
    <br>
    <p>尤舍的监视日志：访问者正在尝试解析底层。正在执行静默<span class="mishi-ink">【重写】</span>。</p>
</div>

<div class="side-console">
    <div>> 状态：逻辑回路断裂</div>
    <div>> 找到缺失的三个关键词以填补漏洞：</div>
    <br>
    <div>1. 尤舍的本质: <span class="slot" id="s1" onclick="ask(1)">____</span></div>
    <div>2. 敲击的位置: <span class="slot" id="s2" onclick="ask(2)">____</span></div>
    <div>3. 正在执行的操作: <span class="slot" id="s3" onclick="ask(3)">____</span></div>
    <br>
    <div>> 最终指令: [ <span id="final_cmd">未就绪</span> ]</div>
</div>

<script>
    // 鼠标跟随逻辑
    document.addEventListener('mousemove', e => {
        document.documentElement.style.setProperty('--cursor-x', e.clientX + 'px');
        document.documentElement.style.setProperty('--y', e.clientY + 'px');
    });

    // 关键词填充逻辑
    const answers = { 1: "算力源", 2: "头盖骨", 3: "重写" };
    let current = { 1: "", 2: "", 3: "" };

    function ask(id) {
        let val = prompt("输入提取到的关键词:");
        if(val === answers[id]) {
            document.getElementById('s' + id).innerText = val;
            current[id] = val;
            checkAll();
        } else {
            document.body.classList.add('error-shake');
            setTimeout(() => document.body.classList.remove('error-shake'), 500);
        }
    }

    function checkAll() {
        if(current[1] && current[2] && current[3]) {
            // 关键词找齐后，触发第二阶段：查看源码获得的组合
            document.getElementById('final_cmd').innerText = "后退3次 + SH";
            alert("米时的声音：‘漏洞已补全！最后的钥匙是我留下的字符。在输入框输入 SH 开启后退协议。’");
            
            // 动态生成输入框，防止遮挡
            let inp = document.createElement('input');
            inp.style.cssText = "position:fixed; top:50%; left:50%; z-index:100; transform:translate(-50%,-50%); padding:10px;";
            inp.placeholder = "输入最终字符";
            inp.oninput = function() {
                if(this.value.toUpperCase() === 'SH') {
                    sessionStorage.setItem("loop_broken", "true");
                    alert("协议激活。开始回退。");
                }
            };
            document.body.appendChild(inp);
        }
    }

    // 莫比乌斯环：禁止右键和普通离开
    window.onpopstate = function() {
        if(sessionStorage.getItem("loop_broken") === "true") {
            window.location.href = "last_sanctuary.html";
        }
    };
    history.pushState(null, null, document.URL);
</script>

</body>
</html>
